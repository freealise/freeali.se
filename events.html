---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: default
---

<style type="text/css">
#map-canvas {
  height: 256px;
  margin: 0;
  padding: 0;
}
</style>

<div id="map-canvas"></div>
<!--add timeline-->
<div id="text"></div>

<script>
function initialize() {
  function showResults(url) {
    var xhttp, xmlDoc, txt, x, i;
    var bounds = map.getBounds();
    var ne = bounds.getNorthEast();
    var sw = bounds.getSouthWest();
    var maxLat = ne.lat();
    var maxLng = ne.lng();
    var minLat = sw.lat();
    var minLng = sw.lng();
    if (window.XMLHttpRequest) {
        // code for modern browsers
        xhttp = new XMLHttpRequest();
    } else {
        // code for old IE browsers
        xhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
           xmlDoc = xhttp.responseXML;
           txt = "";
           x = xmlDoc.getElementsByTagName("entry");
           for (i = 0; i < x.length; i++) {
             var point = x[i].getElementsByTagName("georss:point")[0];
             if (point && point.innerHTML) {
               var coords = point.innerHTML.split(" ");
               var lat = parseFloat(coords[0]);
               var lng = parseFloat(coords[1]);
               if (lat>minLat && lat<maxLat && lng>minLng && lng<maxLng) {
                 txt += "<a href='" + x[i].getElementsByTagName("link")[0].getAttribute("href") + "'>" + x[i].getElementsByTagName("title")[0].innerHTML + "</a><br>";
                 txt += x[i].getElementsByTagName("summary")[0].innerHTML + "<br>";
               }
             }
           }
           document.getElementById("text").innerHTML = txt;
        }
    };
    xhttp.open("GET", url, true);
    xhttp.send();
  }
  
  //geolocate
  var mapOptions = {
    zoom: 4,
    center: {lat: -34.397, lng: 150.644}
  }
  var d = new Date();
  var t = d.getTime();
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  var georssLayer = new google.maps.KmlLayer({
    //url: 'https://www.freealise.com/feeds/posts/default/?q=label:map|label:event&max=500&max-results=500&time='+t
    suppressInfoWindows: true,
    url: 'https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec?a=xml&time='+t
  });
  georssLayer.setMap(map);
  var kmlLayer = new google.maps.KmlLayer({
    url: 'https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec?a=events&time='+t
  });
  kmlLayer.setMap(map);
  google.maps.event.addListener(georssLayer, 'click', function(e) {
    var zoom = map.getZoom();
    if (zoom<12) {
    	map.setZoom(zoom+4);
    }
    map.setCenter(e.latLng);
    var url = "https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec?a=xml";
    showResults(url);
  });
  google.maps.event.addListener(kmlLayer, 'click', function(e) {
    var zoom = map.getZoom();
    if (zoom<12) {
    	map.setZoom(zoom+4);
    }
    map.setCenter(e.latLng);
    var url = "https://www.freealise.com/feeds/posts/default/?max=500&max-results=500";
    showResults(url);
    //xhttp.open("GET", "https://www.freealise.com/feeds/posts/default/?max=500&max-results=500", true);
    //xhttp.open("GET", "https://www.freealise.com/feeds/posts/default/?q="+address+"&max=500&max-results=500", true);
    //xhttp.open("GET", "https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec?a=xml", true);
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDONbj1HFMLs7UI3yBortL4qwLm-0C7mYM&callback=initialize"></script>
