---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: default
---

<style type="text/css">
#map-canvas {
  height: 256px;
  margin: 0;
  padding: 0;
}
</style>

<div id="map-canvas"></div>

      <!-- 1 -->
      <link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">

      <!-- 2 -->
      <script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>

      <div id='timeline-embed' style="width: 100%; height: 600px"></div>

      <!-- 3 -->
      <script type="text/javascript">
        // The TL.Timeline constructor takes at least two arguments:
        // the id of the Timeline container (no '#'), and
        // the URL to your JSON data file or Google spreadsheet.
        // the id must refer to an element "above" this code,
        // and the element must have CSS styling to give it width and height
        // optionally, a third argument with configuration options can be passed.
        // See below for more about options.
        timeline = new TL.Timeline('timeline-embed',
          'https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec?a=past_events');
      </script>

<div id="text"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDONbj1HFMLs7UI3yBortL4qwLm-0C7mYM"></script>
<script>
  function showResults(a) {
    var url = exec+"?a="+a;
    var xhttp, xmlDoc, txt, x, i;
    var bounds = map.getBounds();
    var ne = bounds.getNorthEast();
    var sw = bounds.getSouthWest();
    var maxLat = ne.lat();
    var maxLng = ne.lng();
    var minLat = sw.lat();
    var minLng = sw.lng();
    if (window.XMLHttpRequest) {
        // code for modern browsers
        xhttp = new XMLHttpRequest();
    } else {
        // code for old IE browsers
        xhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
           xmlDoc = xhttp.responseXML;
           txt = "<br>";
           x = xmlDoc.getElementsByTagName("entry");
           for (i = 0; i < x.length; i++) {
             var point = x[i].getElementsByTagName("georss:point")[0];
             if (point && point.innerHTML) {
               var coords = point.innerHTML.split(" ");
               var lat = parseFloat(coords[0]);
               var lng = parseFloat(coords[1]);
               if (lat>minLat && lat<maxLat && lng>minLng && lng<maxLng) {
                 if (a=="xml") {
                    var html = x[i].getElementsByTagName("summary")[0].innerHTML;
                 } else if (a=="blog") {
                    var html = x[i].getElementsByTagName("content")[0].innerHTML;
                 }
                 html = html.replace(/&lt;/g, "<");
                 html = html.replace(/&gt;/g, ">");
                 html = html.replace(/&quot;/g, '"');
                 html = html.replace(/&apos;/g, "'");
                 txt += "<p><b>" + x[i].getElementsByTagName("title")[0].innerHTML + "</b><br>";
                 txt += html + "</p>";  
               }
             }
           }
           document.getElementById("text").innerHTML = txt;
           document.getElementsByTagName("section")[0].style.height="auto";
        }
    };
    xhttp.open("GET", url, true);
    xhttp.send();
  }
  
  var exec="https://script.google.com/macros/s/AKfycby9VN3ghF35t1Z4csV9kycvQyBqiYF8irms_ybLMmsZrKFlU9rb/exec";
  //geolocate
  var mapOptions = {
    zoom: 4,
    center: {lat: -34.397, lng: 150.644}
  }
  var d = new Date();
  var t = d.getTime();
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  var kmlLayer = new google.maps.KmlLayer({
    url: exec+'?a=events&time='+t
  });
  var blogLayer = new google.maps.KmlLayer({
    suppressInfoWindows: true,
    url: 'https://www.freealise.com/feeds/posts/default/?time='+t
  });
  var georssLayer = new google.maps.KmlLayer({
    suppressInfoWindows: true,
    url: exec+'?a=xml&time='+t
  });
  georssLayer.setMap(map);
  
  var listener = google.maps.event.addListener(georssLayer, 'metadata_changed', function() {
    google.maps.event.clearListeners(georssLayer, 'metadata_changed');
    kmlLayer.setMap(map);
    blogLayer.setMap(map);
  });
  
  google.maps.event.addListener(blogLayer, 'click', function(e) {
    var zoom = map.getZoom();
    if (zoom<12) {
    	map.setZoom(zoom+4);
    }
    map.setCenter(e.latLng);
    var a = "blog";
    showResults(a);
  });
  google.maps.event.addListener(georssLayer, 'click', function(e) {
    var zoom = map.getZoom();
    if (zoom<12) {
    	map.setZoom(zoom+4);
    }
    map.setCenter(e.latLng);
    var a = "xml";
    showResults(a);
  });
</script>
