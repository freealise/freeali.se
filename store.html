---
layout: default
---

{% assign itemsByCategory =
    site.items | group_by_exp:"item", "item.categories[0]" %}
<ul>
{% for category in itemsByCategory %}
    <li>
      <a href="#{{ category.name }}"><b>{{ category.name | capitalize }}</b></a>
    </li>
{% endfor %}
</ul>
<hr>

{% for category in itemsByCategory %}
  <h2 id="{{ category.name }}">{{ category.name | capitalize }}</h2>
    {% for item in category.items %}
      <p>
        <a href="{{ item.url }}">
          <img src="{{ item.image }}" width="128" height="128" style="float:left;padding-right:16px">
          <h3>{{ item.title }}{% if item.artist %} by {{ item.artist }}{% endif %}</h3>
        </a>
        <div>
          <div id="share-buttons">
            <a data-sharer="twitter" data-title="{{ item.title }}" data-hashtags="{{ item.tags }}" data-url="{{ site.url }}{{ item.url }}"><span class='symbol'>circletwitterbird</span></a>
            <a data-sharer="facebook" data-hashtag="{{ item.tags }}" data-url="{{ site.url }}{{ item.url }}"><span class='symbol'>circlefacebook</span></a>
          </div>
          <div>
            <b>$ {{ item.cost }}</b><br>  
            {{ item.description }}
          </div>

            <button class="button" onclick="addItem('{{ item.number }}', '{{ item.title }}', {{ item.cost }});">Add to basket</button>
            
            <!-- Load Stripe.js on your website. -->
            <script src="https://js.stripe.com/v3"></script>

            <!-- Create a button that your customers click to complete their purchase. Customize the styling to suit your branding. -->
            <input type="text" id="quantity" size="4">
            <a style="background-color:#000000;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em" id="checkout-button-sku_F65eMglXH2jlzL">Pre-order</a>

            <div id="error-message"></div>

            <script>
              var stripe = Stripe('pk_test_up7XBxmt0W2fKgzk1SxfQymR');

              var checkoutButton = document.getElementById('checkout-button-sku_F65eMglXH2jlzL');
              checkoutButton.addEventListener('click', function () {
               var quantity = parseInt(document.getElementById("quantity").value);
                // When the customer clicks on the button, redirect
                // them to Checkout.
                stripe.redirectToCheckout({
                  items: [{sku: '{{ item.stripe_id }}', quantity: quantity}],

                  // Do not rely on the redirect to the successUrl for fulfilling
                  // purchases, customers may not always reach the success_url after
                  // a successful payment.
                  // Instead use one of the strategies described in
                  // https://stripe.com/docs/payments/checkout/fulfillment
                  successUrl: 'https://www.freealise.com/return.html?msg={{ item.title }} by {{ item.artist }} has been pre-ordered. Thanks for your support!',
                  cancelUrl: 'https://www.freealise.com/return.html?msg=Your payment has been cancelled.',
                })
                .then(function (result) {
                  if (result.error) {
                    // If `redirectToCheckout` fails due to a browser or network
                    // error, display the localized error message to your customer.
                    var displayError = document.getElementById('error-message');
                    displayError.textContent = result.error.message;
                  }
                });
              });
            </script>
        </div>
      </p>
      <br>
    {% endfor %}
{% endfor %}
